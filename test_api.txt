[1mğŸ¯ Iniciando testes da API Flask...[0m
[33mâš™ï¸ Modo debug: ATIVADO[0m
[33mğŸ”§ Para desativar debug, mude debugMode para false[0m

[1mğŸš€ TESTE COMPLETO DA API - VERSÃƒO 3.0[0m
[34mğŸ“… 04/06/2025, 21:43:42[0m
[34mğŸ”— Base URL: http://localhost:5000/api[0m

[1mğŸ” VERIFICANDO SERVIDOR[0m
[32mâœ… Servidor Flask rodando[0m
[32mâœ… VersÃ£o: 2.0[0m
[32mâœ… Database: MySQL[0m

[1mğŸ” SEÃ‡ÃƒO 1: AUTENTICAÃ‡ÃƒO[0m
[34mğŸ“¤ Dados enviados: {
  "email": "maria.rh@techsolutions.com",
  "senha": "123456"
}[0m
[36mğŸŒ POST http://localhost:5000/api/auth/login[0m

[36m=== Login RH ===[0m
âœ… Status: [32m200[0m
[33mâœ… Token recebido: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...[0m
[33mğŸ‘¤ UsuÃ¡rio: Maria Silva (maria.rh@techsolutions.com)[0m
[32mğŸ”‘ Token rh salvo com sucesso[0m
[34mğŸ“¤ Dados enviados: {
  "email": "joao.gestor@techsolutions.com",
  "senha": "123456"
}[0m
[36mğŸŒ POST http://localhost:5000/api/auth/login[0m

[36m=== Login Gestor ===[0m
âœ… Status: [32m200[0m
[33mâœ… Token recebido: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...[0m
[33mğŸ‘¤ UsuÃ¡rio: JoÃ£o Santos (joao.gestor@techsolutions.com)[0m
[32mğŸ”‘ Token gestor salvo com sucesso[0m
[34mğŸ“¤ Dados enviados: {
  "email": "ana.dev@techsolutions.com",
  "senha": "123456"
}[0m
[36mğŸŒ POST http://localhost:5000/api/auth/login[0m

[36m=== Login UsuÃ¡rio Comum ===[0m
âœ… Status: [32m200[0m
[33mâœ… Token recebido: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...[0m
[33mğŸ‘¤ UsuÃ¡rio: Ana Costa (ana.dev@techsolutions.com)[0m
[32mğŸ”‘ Token comum salvo com sucesso[0m
[34mğŸ“¤ Dados enviados: {
  "email": "inexistente@test.com",
  "senha": "senha_errada"
}[0m
[36mğŸŒ POST http://localhost:5000/api/auth/login[0m

[36m=== Login InvÃ¡lido (deve falhar) ===[0m
âœ… Status: [32m401[0m
[33mğŸ“„ Response: {
  "autenticado": false,
  "erro": "Credenciais invÃ¡lidas"
}[0m

[33mğŸ§ª Testando endpoint /me com token RH...[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[36mğŸŒ GET http://localhost:5000/api/auth/me[0m

[36m=== Endpoint /me ===[0m
âœ… Status: [32m200[0m
[33mğŸ“„ Response: {
  "usuario": {
    "UF": "SP",
    "ativo": true,
    "cpf": 12345678901,
    "criado_em": "2025-06-04T23:12:14",
    "email": "maria.rh@techsolutions.com",
    "flag_gestor": "N",
    "grupo_id": 2,
    "grupo_nome": "Recursos Humanos",
    "inicio_na_empresa": "2020-01-15",
    "nome": "Maria Si...[0m

[1mğŸŒ SEÃ‡ÃƒO 2: ENDPOINTS PÃšBLICOS[0m
[36mğŸŒ GET http://localhost:5000/api/ufs[0m

[36m=== Listar UFs (pÃºblico) ===[0m
âœ… Status: [32m200[0m
[33mğŸ“‹ Array com 27 itens[0m
[33mğŸ“„ Primeiro item: {
  "cod_uf": 12,
  "uf": "AC"
}...[0m
[36mğŸŒ GET http://localhost:5000/api/tipos-ausencia[0m

[36m=== Listar Tipos de AusÃªncia (pÃºblico) ===[0m
âœ… Status: [32m200[0m
[33mğŸ“‹ Array com 10 itens[0m
[33mğŸ“„ Primeiro item: {
  "descricao": "FÃ©rias",
  "id": 1,
  "usa_turno": false
}...[0m
[36mğŸŒ GET http://localhost:5000/api/turnos[0m

[36m=== Listar Turnos (pÃºblico) ===[0m
âœ… Status: [32m200[0m
[33mğŸ“‹ Array com 5 itens[0m
[33mğŸ“„ Primeiro item: {
  "descricao": "ManhÃ£",
  "id": 1
}...[0m

[1mğŸ”’ SEÃ‡ÃƒO 3: ENDPOINTS PROTEGIDOS[0m

[36mğŸ‘©â€ğŸ’¼ Testando com usuÃ¡rio RH[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[36mğŸŒ GET http://localhost:5000/api/usuarios[0m

[36m=== RH - Listar UsuÃ¡rios ===[0m
âœ… Status: [32m200[0m
[33mğŸ“‹ Array com 3 itens[0m
[33mğŸ“„ Primeiro item: {
  "UF": "SP",
  "ativo": true,
  "cpf": 12345678901,
  "criado_em": "2025-06-04T23:12:14",
  "emai...[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[36mğŸŒ GET http://localhost:5000/api/grupos[0m

[36m=== RH - Listar Grupos ===[0m
âœ… Status: [32m200[0m
[33mğŸ“‹ Array com 3 itens[0m
[33mğŸ“„ Primeiro item: {
  "ativo": true,
  "cnpj_empresa": 12345678000190,
  "criado_em": "2025-06-04",
  "descricao": "Eq...[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[36mğŸŒ GET http://localhost:5000/api/empresas[0m

[36m=== RH - Listar Empresas ===[0m
âœ… Status: [32m200[0m
[33mğŸ“‹ Array com 1 itens[0m
[33mğŸ“„ Primeiro item: {
  "ativa": true,
  "cnpj": 12345678000190,
  "criado_em": "2025-06-04",
  "email": "contato@techso...[0m

[36mğŸ‘¨â€ğŸ’¼ Testando com usuÃ¡rio Gestor[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[36mğŸŒ GET http://localhost:5000/api/usuarios[0m

[36m=== Gestor - Listar UsuÃ¡rios do Grupo ===[0m
âœ… Status: [32m200[0m
[33mğŸ“‹ Array com 2 itens[0m
[33mğŸ“„ Primeiro item: {
  "UF": "SP",
  "ativo": true,
  "cpf": 23456789012,
  "criado_em": "2025-06-04T23:12:16",
  "emai...[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[36mğŸŒ GET http://localhost:5000/api/empresas[0m

[36m=== Gestor - Tentar Acessar Empresas (deve falhar) ===[0m
âœ… Status: [32m403[0m
[33mğŸ“„ Response: {
  "erro": "Apenas RH pode acessar dados de empresas"
}[0m

[36mğŸ‘¤ Testando com usuÃ¡rio Comum[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[36mğŸŒ GET http://localhost:5000/api/eventos[0m

[36m=== UsuÃ¡rio - Listar Eventos PrÃ³prios ===[0m
âœ… Status: [32m200[0m
[33mğŸ“‹ Array com 0 itens[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[34mğŸ“¤ Dados enviados: {
  "cpf": "99988877766",
  "nome": "Teste Sem PermissÃ£o",
  "email": "teste@test.com",
  "senha": "123456"
}[0m
[36mğŸŒ POST http://localhost:5000/api/usuarios[0m

[36m=== UsuÃ¡rio - Tentar Criar UsuÃ¡rio (deve falhar) ===[0m
âœ… Status: [32m403[0m
[33mğŸ“„ Response: {
  "erro": "Sem permissÃ£o para criar usuÃ¡rios"
}[0m

[1mğŸ“ SEÃ‡ÃƒO 4: OPERAÃ‡Ã•ES CRUD[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[36mğŸŒ GET http://localhost:5000/api/grupos/2[0m
[34mğŸ¢ CNPJ da empresa do RH: 12345678000190[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[34mğŸ“¤ Dados enviados: {
  "nome": "Grupo Teste 1749084256389",
  "cnpj_empresa": 12345678000190,
  "telefone": "(11) 1234-5678",
  "descricao": "Grupo criado durante teste automatizado"
}[0m
[36mğŸŒ POST http://localhost:5000/api/grupos[0m

[36m=== Criar Novo Grupo ===[0m
âœ… Status: [32m201[0m
[33mğŸ“„ Response: {
  "ativo": true,
  "cnpj_empresa": 12345678000190,
  "criado_em": "2025-06-04",
  "descricao": "Grupo criado durante teste automatizado",
  "empresa_nome": "Tech Solutions LTDA",
  "id": 5,
  "nome": "Grupo Teste 1749084256389",
  "telefone": "(11) 1234-5678",
  "total_usuarios": 0
}[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[34mğŸ“¤ Dados enviados: {
  "descricao": "Grupo atualizado durante teste"
}[0m
[36mğŸŒ PUT http://localhost:5000/api/grupos/5[0m

[36m=== Atualizar Grupo Criado ===[0m
âœ… Status: [32m200[0m
[33mğŸ“„ Response: {
  "status": "Grupo atualizado"
}[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[34mğŸ“¤ Dados enviados: {
  "cpf_usuario": 34567890123,
  "data_inicio": "2025-06-15",
  "data_fim": "2025-06-19",
  "id_tipo_ausencia": 1,
  "uf": "SP"
}[0m
[36mğŸŒ POST http://localhost:5000/api/eventos[0m

[36m=== UsuÃ¡rio - Criar Novo Evento ===[0m
âœ… Status: [32m201[0m
[33mğŸ“„ Response: {
  "UF": "SP",
  "aprovado_por": 34567890123,
  "aprovado_por_nome": "Ana Costa",
  "cpf_usuario": 34567890123,
  "criado_em": "2025-06-05T00:44:26",
  "data_fim": "2025-06-19",
  "data_inicio": "2025-06-15",
  "id": 6,
  "id_tipo_ausencia": 1,
  "status": "pendente",
  "tipo_ausencia_desc": "FÃ©ria...[0m

[1mğŸ›¡ï¸ SEÃ‡ÃƒO 5: VALIDAÃ‡Ã•ES DE SEGURANÃ‡A[0m
[36mğŸŒ GET http://localhost:5000/api/usuarios[0m

[36m=== Acesso sem token (deve falhar) ===[0m
âœ… Status: [32m401[0m
[33mğŸ“„ Response: {
  "erro": "Token de acesso necessÃ¡rio"
}[0m
[33mğŸ”‘ Token usado: token-completamente-...[0m
[36mğŸŒ GET http://localhost:5000/api/usuarios[0m

[36m=== Token invÃ¡lido (deve falhar) ===[0m
âœ… Status: [32m401[0m
[33mğŸ“„ Response: {
  "erro": "Token invÃ¡lido"
}[0m
[33mğŸ”‘ Token usado: Bearer token-malform...[0m
[36mğŸŒ GET http://localhost:5000/api/usuarios[0m

[36m=== Token malformado (deve falhar) ===[0m
âœ… Status: [32m401[0m
[33mğŸ“„ Response: {
  "erro": "Token invÃ¡lido"
}[0m

[1mğŸšª SEÃ‡ÃƒO 6: LOGOUT[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[36mğŸŒ POST http://localhost:5000/api/auth/logout[0m

[36m=== Logout RH ===[0m
âœ… Status: [32m200[0m
[33mğŸ“„ Response: {
  "message": "Logout realizado com sucesso"
}[0m
[33mğŸ”‘ Token usado: eyJhbGciOiJIUzI1NiIs...[0m
[36mğŸŒ GET http://localhost:5000/api/auth/me[0m

[36m=== Usar token apÃ³s logout (deve falhar) ===[0m
âœ… Status: [32m401[0m
[33mğŸ“„ Response: {
  "erro": "Token invalidado"
}[0m

[1mğŸ“Š RELATÃ“RIO FINAL[0m
============================================================
[1mTotal de Testes:[0m 23
[32mTestes Passaram:[0m 23
[31mTestes Falharam:[0m 0
[1mTaxa de Sucesso:[0m [32m100.0%[0m

[1mğŸ”‘ TOKENS OBTIDOS:[0m
[32mâœ… RH: OK[0m
[32mâœ… GESTOR: OK[0m
[32mâœ… COMUM: OK[0m

[1mğŸ’¡ DIAGNÃ“STICO:[0m
[32mğŸ‰ API funcionando perfeitamente![0m

[1mğŸ”§ COMANDOS ÃšTEIS:[0m
[36m- Recriar dados: python scripts/seed_data_complete.py[0m
[36m- Verificar integridade: python scripts/validate_integrity.py[0m
[36m- Verificar ambiente: python scripts/check_environment.py[0m
